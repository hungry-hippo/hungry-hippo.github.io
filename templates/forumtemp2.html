<!doctype html>
<head>
     <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='tablestyle.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='modalstyle.css') }}">
     <style>
         th {width: 20px;}



     </style>
</head>
<body>
<table>
    <tr>
        <td>
        <h1> {{ heading.heading }} </h1>
        {{ heading. text }}
        </td>
    </tr>
</table>

<br><br>

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
      <p><h1>Modify Your Comment </h1>
        <form method="POST">
            {{ modform.csrf_token }}
            {{ modform.modifytext.label}} {{modform.modifytext(class_='modaltext')}}
            {{ modform.modifyid(class_='modalid')}}
            {{ modform.commentmod }}
            {% if modform.errors and modform.commentmod.data %}
                {% for field, error in modform.errors.items() %}
                    <div class="alert alert-danger" role="alert">
                        {{ error }}
                    </div>
                {% endfor %}
            {% endif %}
        </form>
    </p>
  </div>

</div>

<table>
    {% for dat in data %}
            <tr>
                <td>
                    <div style="text-align: right;">
                        <h2>
                            {{ dat.text }}
                        </h2>

                        Posted by {{ dat.username }}
                        {% if user.usertype==3 or user.username==dat.username %}
                            <br><br>
                            {# button to delete comment #}
                            <button id={{ dat.id }} onclick=delid(id)>Delete</button>

                            {# button to modify comment #}
                            <button id=m{{ dat.id }} onclick="modalopen('{{dat.id}}','{{dat.text}}')">Modify</button>

                        {% endif %}
                    </div>
                </td>
            </tr>


    {% endfor %}
</table>

{# Comment Box #}
<form method="POST">
    {{ form.csrf_token }}
    <br>
    {{ user.username }}
    <br>
    {{ form.text.label }} {{ form.text(size=167) }}
    <input type="submit" value="Reply">
    {% if form.errors %}
        {% for field, error in form.errors.items() %}
            <div class="alert alert-danger" role="alert">
                {{ error }}
            </div>
        {% endfor %}
    {% endif %}
</form>

<form method="POST">
    {{ delform.id }}
    <input id=button type="submit" hidden="true">
</form>
<br>

</body>
<script type="text/javascript">
    function delid(id)
    {
        document.getElementById('id').value = id;
        document.getElementById('button').click();
    }

    function replytofunc(replyid)
    {   //window.alert(replyid);
        //document.write(replyid);
        var i;
        //var elements = document.getElementsByClassName('repliesto');

        //for(i=0; i<elements.length; i++) {
        //    elements[i].value = replyid;
        //}

    }
// Get the modal
var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
function modalopen(id, data) {
    modal.style.display = "block";
    document.getElementsByClassName("modaltext")[0].value= data;
    document.getElementsByClassName("modalid")[0].value = id;
    //window.alert(data);
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}


</script>